<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8">
<title>ErfGeo | Handleiding OpenRefine / ErfGeoProxy </title>

<meta name="author" content="Waag Society">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="icon" type="image/png" href="/assets/images/erfgeo.png">

<script src="/assets/js/d3.v3.min.js"></script>

<link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
  <div class="table-container">

    <div class="table-block footer-push">
      <header class="header-default">
  <a href="/" class="logo">
    <span>Erf</span>Geo</a>
  </a>
  <span id="toggle-main-menu"><span class="icon"></span></span>
<nav id="main-menu">
  
  
    <ul>
      
        
          <li class="has-sub-menu">
            <a>Zoeken</a>
            <ul class="sub-menu">
              
                <li class="">
                  <a href="/kaart">Zoeken via kaart</a>
                </li>
              
                <li class="">
                  <a href="/thesaurus">Tekstueel zoeken</a>
                </li>
              
            </ul>
          </li>
        
      
        
          <li class="">
            <a href="/blog">Blog</a>
          </li>
        
      
        
          <li class="current">
            <a href="/wat-hoe">Wat? Hoe?</a>
          </li>
        
      
        
          <li class="">
            <a href="/tools">Tools</a>
          </li>
        
      
    </ul>
  
</nav>
<script type="text/javascript">
document.getElementById("toggle-main-menu").onclick = function() {
  document.getElementsByTagName("body")[0].classList.toggle("main-menu-active");
};

var itemsWithSubMenu = document.getElementsByClassName("has-sub-menu");
for (var i = 0; i < itemsWithSubMenu.length; i++) {
  itemsWithSubMenu[i].onclick = function() {
    this.classList.toggle("active");
  };
}
</script>
</header>


      <div class="container">
        <div id="content" class="content-block">
          <h1>Handleiding OpenRefine / ErfGeoProxy</h1>
          
            <div class="author">door: Menno den Engelse</div>
          
          <h2 id="plaatsnamen-standaardiseren-met-openrefine">Plaatsnamen standaardiseren met OpenRefine</h2>

<p><a href="http://openrefine.org/">OpenRefine</a> (voorheen Google Refine) is een handige tool om data mee op te schonen en te verrijken. Je kunt OpenRefine ook gebruiken om plaatsnamen te standaardiseren - volg daarvoor de hieronder beschreven procedure. Als alternatief kunt u ook de <a href="standaardiseertool.html">Standaardiseertool</a> gebruiken.</p>

<h3 id="1-open-je-databestand-in-openrefine">1) Open je databestand in OpenRefine</h3>

<p>Raadpleeg de <a href="http://openrefine.org/documentation.html">OpenRefine documentatie</a> als je ergens niet uitkomt. Zorg dat je de plaatsnamen die je wilt standaardiseren in een aparte kolom hebt staan en open je databestand in OpenRefine.</p>

<h3 id="2-hou-de-plaatsnamen-tegen-de-erfgeo-api">2) Hou de plaatsnamen tegen de ErfGeo API</h3>

<p>Omdat de ErfGeo API zelf zoveel informatie biedt, dat het overzicht in deze exercitie enigszins verloren gaat, gebruiken we de boven op deze API gebouwde <a href="http://www.hicsuntleones.nl/erfgeoproxy/">ErfGeo Proxy</a>.</p>

<p>We gaan OpenRefine elke plaatsnaam tegen deze proxy houden en kiezen daarvoor in het menuutje bovenin de plaatsnamenkolom <code class="highlighter-rouge">Edit column &gt; Add column by fetching url</code>.</p>

<p><img src="/assets/images/add-column.png" alt="add column" /></p>

<p>In het dialoogvenstertje dat nu opent geef je de nieuwe kolom een naam en vul je de expressie <code class="highlighter-rouge">"http://www.hicsuntleones.nl/erfgeoproxy/search/?q=" + escape(value,"url") + "&amp;dataset=geonames"</code> in. Je precieze expressie is natuurlijk afhankelijk van wat je wilt standaardiseren en waar naar toe - je kan in plaats van ‘geonames’ ook ‘tgn’ gebruiken.</p>

<p><img src="/assets/images/add-column2.png" alt="add column" /></p>

<p>Als je op ‘OK’ klikt begint het proces. Dit kan een tijdje duren - een goed moment om koffie te gaan zetten. Maar als alles goed is gegaan zie je na verloop van tijd een extra kolom met het resultaat van je api aanroep.</p>

<p><img src="/assets/images/erfgeojson.png" alt="json" /></p>

<h3 id="3-json-parsen">3) JSON parsen</h3>

<p>Het verkregen resultaat bevat, voor zover de api wat met je zoekvraag kon, de gegevens waar je naar op zoek was - in ons geval een GeoNames URI en een coördinaat.</p>

<p>Kies in het menuutje bovenin de kolom met het resultaat ‘Edit column &gt; Add column based on this column’ en vul in het dialoogvenstertje de expressie <code class="highlighter-rouge">value.parseJson().results[0].geonames.uri</code> in.</p>

<p><img src="/assets/images/add-column3.png" alt="add column" /></p>

<p>Het resultaat is een extra kolom waar we keurig de GeoNames URIs in terugvinden. Als we de laatste handeling twee keer herhalen met de expressies <code class="highlighter-rouge">value.parseJson().results[0].geonames.geometry.coordinates[1]</code> en <code class="highlighter-rouge">value.parseJson().results[0].geonames.geometry.coordinates[0]</code> hebben we ook de lattitude en longitude geëxtraheerd.</p>

<p><img src="/assets/images/result.png" alt="resultaat" /></p>

<h3 id="4-data-opschonen">4) data opschonen</h3>

<p>Heb je echt goed opgelet, dan ben je in één van de dialoogvenstertjes hierboven een stukje json met twee resultaten voor ‘Nederland’ tegengekomen. Welke de juiste is, het land of het Gelderse plaatsje met dezelfde naam, dat zou eigenlijk handmatig bepaald moeten worden.</p>

<p>Stel dat we alleen een uri, lat en long willen opnemen wanneer er maar één resultaat is. Dan extraheren we eerst het ‘num-found-with-datasets’ op dezelfde wijze zoals we dat met de GeoNames URI, de lattitude en de longitude hebben gedaan. Gebruik daarvoor de expressie <code class="highlighter-rouge">value.parseJson()['num-found-with-datasets']</code>.</p>

<p>Klik dan op <code class="highlighter-rouge">Facet &gt; Numeric Facet</code> in het menu bovenin de kolom ‘count’,</p>

<p><img src="/assets/images/numeric-facet.png" alt="numeric facet" /></p>

<p>In de linkerkolom verschijnt nu je facet, die je zo instelt dat alleen records met 2 of meer resultaten worden geselecteerd.</p>

<p><img src="/assets/images/numeric-facet-slide.png" alt="numeric facet slide" /></p>

<p>Pas dan <code class="highlighter-rouge">Edit cells &gt; Common transforms &gt; Blank out cells</code> toe op de velden long, lat en geonames.</p>

<p><img src="/assets/images/blank.png" alt="blank out cells" /></p>

<p>Verwijder de facet, zodat alle records weer te zien zijn. En voilá, Nederland is weer leeg!</p>

<p><img src="/assets/images/nederland.png" alt="nl≠vol" /></p>

<p>Op dezelfde manier kan je natuurlijk ook de BAG id’s van gebouwen zoeken, de NWB geometrie van straten, etc.</p>

        </div>
      </div>
    </div>

    <div class="table-block">
      <footer id="footer">
  <div class="container">
    <a href="/over-ons#contact">contact</a> | <a href="/over-ons">over ons</a>
  </div>
</footer>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-63876258-1', 'auto');
  ga('send', 'pageview');
</script>
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["setDomains", ["*.erfgeo.nl"]]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.waag.org/";
    _paq.push(['setTrackerUrl', u+'piwik.php']);
    _paq.push(['setSiteId', '12']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript><p><img src="//stats.waag.org/piwik.php?idsite=12" style="border:0;" alt="" /></p></noscript>
<!-- End Piwik Code -->
    </div>

  </div>
</body>
</html>
